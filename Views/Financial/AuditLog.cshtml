@model IEnumerable<AirbnbShopApi.Models.AuditLog>

@{
    ViewData["Title"] = "Logs de Auditoria";
    var page = ViewBag.Page as int? ?? 1;
    var totalPages = ViewBag.TotalPages as int? ?? 1;
    var startDate = ViewBag.StartDate as DateTime?;
    var endDate = ViewBag.EndDate as DateTime?;
}

<h2>@ViewData["Title"]</h2>

<form asp-action="AuditLog" method="get">
    <div class="form-group">
        <label>Data Inicial</label>
        <input type="datetime-local" name="startDate" class="form-control" value="@(startDate.HasValue ? startDate.Value.ToString("yyyy-MM-ddTHH:mm") : "")" />
    </div>
    <div class="form-group">
        <label>Data Final</label>
        <input type="datetime-local" name="endDate" class="form-control" value="@(endDate.HasValue ? endDate.Value.ToString("yyyy-MM-ddTHH:mm") : "")" />
    </div>
    <button type="submit" class="btn btn-primary">Filtrar</button>
</form>

<table class="table mt-3">
    <thead>
    <tr>
        <th>Data/Hora</th>
        <th>Usuário</th>
        <th>Ação</th>
        <th>Tipo de Entidade</th>
        <th>ID da Entidade</th>
        <th>Detalhes</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var log in Model)
    {
        <tr>
            <td>@log.Timestamp.ToString("dd/MM/yyyy HH:mm:ss")</td>
            <td>@log.User.UserName</td>
            <td>@log.Action</td>
            <td>@log.EntityType</td>
            <td>@log.EntityId</td>
            <td>@log.Details</td>
        </tr>
    }
    </tbody>
</table>

<nav aria-label="Paginação">
    <ul class="pagination">
        <li class="page-item @(page == 1 ? "disabled" : "")">
            <a class="page-link" href="@Url.Action("AuditLog", new { page = page - 1, startDate, endDate })" aria-label="Anterior">
                <span aria-hidden="true">«</span>
            </a>
        </li>
        @for (int i = 1; i <= totalPages; i++)
        {
            <li class="page-item @(i == page ? "active" : "")">
                <a class="page-link" href="@Url.Action("AuditLog", new { page = i, startDate, endDate })">@i</a>
            </li>
        }
        <li class="page-item @(page == totalPages ? "disabled" : "")">
            <a class="page-link" href="@Url.Action("AuditLog", new { page = page + 1, startDate, endDate })" aria-label="Próximo">
                <span aria-hidden="true">»</span>
            </a>
        </li>
    </ul>
</nav>